<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Michaels Family tree</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2H8Y9b3gqk4wF8r2k3m6z9q2VvXKp6f5xYw5qWw=" crossorigin=""/>

  <!-- Your main stylesheet -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* Small local overrides to ensure tree visuals match the reference image */
    :root{
      --card-border:#2f3650;
      --connector-color:#2f3650;
      --accent:#1f6feb;
      --muted:#6b7280;
      --card:#fff;
    }

    /* make portrait circle look like the example (small circle within card) */
    .node img.placeholder {
      width:64px;
      height:64px;
      border-radius:50%;
      border:3px solid white;
      box-shadow:0 2px 6px rgba(0,0,0,0.12);
      background:linear-gradient(180deg,#f4f6fa,#e9eef8);
      display:block;
      margin: -32px auto 8px; /* float above the card top */
      position:relative;
      z-index:2;
    }

    /* style the node card so portrait overlaps it (like reference) */
    .node {
      display:inline-block;
      background:var(--card);
      border-radius:10px;
      padding:36px 14px 14px;
      min-width:180px;
      max-width:210px;
      box-shadow:0 12px 30px rgba(15,23,42,0.06);
      border:2px solid var(--card-border);
      text-align:center;
      position:relative;
    }

    /* subtle lines thickness */
    .family-tree ul ul::before { background: var(--connector-color); height:20px; }
    .family-tree li::before { border-left-color: var(--connector-color); height:20px; top:-20px; }

    /* label styling inside cards */
    .node .label { font-weight:700; font-size:14px; color:#0f1724; margin-top:6px; }
    .node .sub { display:block; font-size:12px; color:var(--muted); margin-top:6px; }

    /* couple small gap */
    .couple-inline { gap:14px; }

    /* tighten spacing for large tree */
    .family-tree { padding:32px 16px 120px; }

    /* ensure modal content is readable */
    .modal-card p { line-height:1.5; color:#111827; font-size:15px; }

    /* small responsive tweak */
    @media (max-width:980px){
      .node { min-width:92%; max-width:92%; padding-top:48px; }
      .node img.placeholder { width:72px; height:72px; margin-top:-48px; }
    }

    /* map container style */
    #birth-map { height:72vh; min-height:420px; border-radius:12px; margin:18px 0; border:2px solid rgba(15,23,42,0.06); }
    .map-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }
    .small-btn { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; background:#e5e7eb; font-weight:600; }
    .small-btn.primary { background:var(--accent); color:#fff; }

    /* Top tabs */
    .top-tabs { display:flex; justify-content:center; gap:6px; padding:12px 8px; background:linear-gradient(90deg,var(--accent),#174b93); }
    .top-tabs button { background:transparent; border:none; color:white; padding:10px 16px; font-weight:700; border-radius:8px; cursor:pointer; opacity:0.95; }
    .top-tabs button.active { background:rgba(255,255,255,0.10); box-shadow:0 6px 18px rgba(2,6,23,0.18); }
    @media (max-width:720px){ .top-tabs { padding:8px; } .top-tabs button{ padding:8px 10px; font-size:14px; } }

  </style>
</head>
<body>
  <!-- === TOP TABS (top of everything) === -->
  <div class="top-tabs" role="tablist" aria-label="View toggle">
    <button id="tabTree" class="active" aria-controls="treePage" aria-selected="true">Family Tree View</button>
    <button id="tabMap" aria-controls="mapPage" aria-selected="false">Birth Map View</button>
  </div>

  <header>
    <h1>Family Tree — Full (Top → Down)</h1>
    <p>Click any portrait to read their story. Use the map to see birthplaces.</p>
  </header>

  <!-- ====================== FAMILY TREE ====================== -->
  <main id="treePage" class="tree-container tree-view" style="display:block;">
    <section class="family-tree">
      <!-- (Your full tree structure — unchanged) -->
      <ul>
        <!-- LEFT great-grand pair -->
        <li>
          <div class="node">
            <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
              <div class="node" onclick="openStory('james_vaccaro')" title="James Vaccaro">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">James Vaccaro</div>
                <div class="sub">1913–1985</div>
              </div>

              <div class="node" onclick="openStory('rose_kirila')" title="Rose Louise Kirila">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Rose Louise Kirila</div>
                <div class="sub">Hungarian → Ohio</div>
              </div>
            </div>

            <ul>
              <li>
                <div class="node" onclick="openStory('deborah')" title="Deborah Patton">
                  <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                  <div class="label">Deborah (Vaccaro)</div>
                  <div class="sub">b. 1959</div>
                </div>

                <ul>
                  <li>
                    <div class="node" onclick="openStory('daniel')" title="Daniel Patton">
                      <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                      <div class="label">Daniel Patton</div>
                      <div class="sub">b. 1992</div>
                    </div>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </li>

        <!-- MIDDLE top great-grand pair -->
        <li>
          <div class="node">
            <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
              <div class="node" onclick="openStory('william_patton')" title="William Patton">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">William Patton</div>
                <div class="sub">Northern Ireland</div>
              </div>

              <div class="node" onclick="openStory('beatrice_fisher')" title="Beatrice Fisher">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Beatrice Fisher</div>
                <div class="sub">Fisher / Crozier</div>
              </div>
            </div>

            <ul>
              <li>
                <div class="node" onclick="openStory('lynne')" title="Lynne Patton">
                  <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                  <div class="label">Lynne Patton</div>
                  <div class="sub">Sister of Gary</div>
                </div>
              </li>

              <li>
                <div class="node" onclick="openStory('gary')" title="Gary Patton">
                  <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                  <div class="label">Gary Patton</div>
                  <div class="sub">b. 1956 — Belfast</div>
                </div>

                <ul>
                  <li>
                    <div class="node" style="padding-top:28px;">
                      <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
                        <div class="node" onclick="openStory('deborah')">
                          <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                          <div class="label">Deborah Patton</div>
                          <div class="sub">b. 1959</div>
                        </div>

                        <div class="node" onclick="openStory('gary')">
                          <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                          <div class="label">Gary Patton</div>
                          <div class="sub">Belfast → California</div>
                        </div>
                      </div>

                      <ul>
                        <li>
                          <div class="node" onclick="openStory('shannen')" title="Shannen Patton">
                            <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                            <div class="label">Shannen Patton</div>
                            <div class="sub">b. 1987</div>
                          </div>

                          <ul>
                            <li>
                              <div class="node" style="padding-top:28px;">
                                <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
                                  <div class="node" onclick="openStory('brian')" title="Brian Kupfer">
                                    <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                                    <div class="label">Brian Kupfer</div>
                                    <div class="sub">b. 1981</div>
                                  </div>

                                  <div class="node" onclick="openStory('shannen')" title="Shannen Patton">
                                    <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                                    <div class="label">Shannen Patton</div>
                                    <div class="sub">m. 2020</div>
                                  </div>
                                </div>

                                <ul>
                                  <li>
                                    <div class="node" onclick="openStory('michael')" title="Michael Dean">
                                      <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                                      <div class="label">Michael Dean</div>
                                      <div class="sub">b. Dec 10 / 2008</div>
                                    </div>

                                    <ul>
                                      <li>
                                        <div class="node" onclick="openStory('breanna')" title="Breanna Kupfer">
                                          <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                                          <div class="label">Breanna Kupfer</div>
                                          <div class="sub">b. 10 Nov 2021</div>
                                        </div>
                                      </li>
                                      <li>
                                        <div class="node" onclick="openStory('alexis')" title="Alexis Kupfer">
                                          <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                                          <div class="label">Alexis Kupfer</div>
                                          <div class="sub">b. 8 Jun 2016</div>
                                        </div>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>

                              </div>
                            </li>
                          </ul>

                        </li>
                      </ul>
                    </div>
                  </li>

                </div>
              </li>
            </ul>
          </div>
        </li>

        <!-- RIGHT-side and bottom clusters -->
        <li>
          <div class="node">
            <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
              <div class="node" onclick="openStory('eugene')">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Eugene Kirili</div>
                <div class="sub">1936–1994</div>
              </div>

              <div class="node" onclick="openStory('ruth_barris')">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Ruth Barris</div>
                <div class="sub">b. 1939</div>
              </div>
            </div>

            <ul>
              <li>
                <div class="node" onclick="openStory('fisher_note')">
                  <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                  <div class="label">Fisher / Crozier notes</div>
                  <div class="sub">name variants</div>
                </div>
              </li>
            </ul>
          </div>
        </li>

        <li style="margin-top:18px;">
          <div class="node">
            <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
              <div class="node" onclick="openStory('robert_kupfer')">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Robert Kupfer</div>
                <div class="sub">Kupfer root</div>
              </div>

              <div class="node" onclick="openStory('patricia_kupfer')">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Patricia Kupfer</div>
                <div class="sub"></div>
              </div>
            </div>

            <ul>
              <li><div class="node" onclick="openStory('cort')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Cort Kupfer</div></div></li>
              <li><div class="node" onclick="openStory('brian')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Brian Kupfer</div></div></li>
              <li><div class="node" onclick="openStory('crystal')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Crystal Kupfer</div></div></li>
              <li><div class="node" onclick="openStory('april')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">April Kupfer</div></div></li>
              <li><div class="node" onclick="openStory('everett')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Everett Kupfer</div></div></li>
              <li><div class="node" onclick="openStory('jonathan')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Jonathan Kupfer</div></div></li>
            </ul>
          </div>
        </li>

        <li style="margin-top:18px;">
          <div class="node">
            <div class="couple-inline" style="display:flex;align-items:center;justify-content:center;">
              <div class="node" onclick="openStory('nannete')">
                <img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt="">
                <div class="label">Nannete Dean</div>
                <div class="sub">Aunt</div>
              </div>
            </div>

            <ul>
              <li><div class="node" onclick="openStory('mario')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Mario Dean</div></div></li>
              <li><div class="node" onclick="openStory('carlo')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Carlo Dean</div></div></li>
              <li><div class="node" onclick="openStory('renato')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Renato Dean</div></div></li>
              <li><div class="node" onclick="openStory('demarco')"><img class="placeholder" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Demarco Victoria</div></div></li>
              <li><div class="node" onclick="openStory('gino')"><img class="placeholder' src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23f3f6fb"/><circle cx="64" cy="64" r="56" fill="%23cbd5e1"/></svg>' alt=""><div class="label">Gino Dean</div></div></li>
              <li><div class="node" onclick="openStory('giana')"><img class="placeholder' src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill='%23f3f6fb'/><circle cx='64' cy='64' r='56' fill='%23cbd5e1'/></svg>' alt=""><div class="label">Giana Dean</div></div></li>
              <li><div class="node" onclick="openStory('demetri')"><img class="placeholder' src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill='%23f3f6fb'/><circle cx='64' cy='64' r='56' fill='%23cbd5e1'/></svg>' alt=""><div class="label">Demetri Dean</div></div></li>
            </ul>
          </div>
        </li>

      </ul>
    </section>
  </main>

  <!-- ====================== MAP PAGE (same file) ====================== -->
  <main id="mapPage" class="tree-container map-view" style="display:none;">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:18px;">
      <h2 style="margin:0">Birth Map</h2>
      <div class="map-actions">
        <button id="btnReturn" class="small-btn">Return to Tree</button>
      </div>
    </div>

    <div id="birth-map" aria-label="Birthplace map"></div>
    <p style="margin-top:10px;font-size:14px;color:var(--muted)">Click a marker to view the person and open their story card.</p>
  </main>

  <!-- ====================== STORY MODAL ====================== -->
  <div id="story-modal" class="modal" style="display:none;">
    <div class="modal-card">
      <button id="closeModal" onclick="closeStory()" style="position:absolute;right:12px;top:10px;padding:6px 8px;border-radius:8px;border:none;background:#efefef;cursor:pointer;">Close</button>
      <div id="story-content"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-V3D3V0sXH8VYd0q3w6tZ8p0i3WmXgI+qKqZ3E7m1w0k=" crossorigin=""></script>

  <script>
    // stories (unchanged)
    const stories = {
      "james_vaccaro": {"title":"James Vaccaro (1913–1985)","photo":"","text":"James was born in Pennsylvania and grew up during hard times..."},
      "rose_kirila": {"title":"Rose Louise Kirila","photo":"","text":"Rose was the bridge between Hungary and Ohio..."},
      "deborah": {"title":"Deborah (née Vaccaro) Patton (b. 1959)","photo":"","text":"Deborah’s childhood was threaded by the rhythms..."},
      "william_patton": {"title":"William Patton","photo":"","text":"William carried Northern Ireland with him..."},
      "beatrice_fisher": {"title":"Beatrice Fisher (Crozier connection)","photo":"","text":"Beatrice’s memory is a tapestry of faith..."},
      "lynne": {"title":"Lynne Patton","photo":"","text":"Lynne is remembered as a steady presence..."},
      "gary": {"title":"Gary Patton (b. 1956)","photo":"","text":"Gary was born in Belfast into a household..."},
      "daniel": {"title":"Daniel Patton (b. 1992)","photo":"","text":"Daniel grew up in Woodland Hills..."},
      "shannen": {"title":"Shannen Patton (b. 1987)","photo":"","text":"Born in Woodland Hills..."},
      "brian": {"title":"Brian Kupfer (b. 1981)","photo":"","text":"Brian is the kind of practical teacher people remember..."},
      "breanna": {"title":"Breanna Kupfer (b. 2021)","photo":"","text":"Breanna arrived to a household full of laughter..."},
      "alexis": {"title":"Alexis Kupfer (b. 2016)","photo":"","text":"Alexis brings an early affection for storytelling..."},
      "robert_kupfer": {"title":"Robert Kupfer","photo":"","text":"Robert is the elder presence of the Kupfer side..."},
      "patricia_kupfer": {"title":"Patricia Kupfer","photo":"","text":"Patricia held the family together with small rituals..."},
      "cort": {"title":"Cort Kupfer","photo":"","text":"Cort is known in family circles as someone who carries on the humor..."},
      "crystal": {"title":"Crystal Kupfer","photo":"","text":"Crystal is a mother first and foremost..."},
      "april": {"title":"April Kupfer","photo":"","text":"April’s life has had its complications..."},
      "everett": {"title":"Everett Kupfer","photo":"","text":"Everett served in the Air Force..."},
      "jonathan": {"title":"Jonathan Kupfer","photo":"","text":"Jonathan is a quieter member of the extended group..."},
      "nannete": {"title":"Nannete Dean","photo":"","text":"Nannete was raised partly in France..."},
      "mario": {"title":"Mario Dean (1985–2014)","photo":"","text":"Mario’s life was short and intense..."},
      "carlo": {"title":"Carlo Dean","photo":"","text":"Carlo’s story includes both complications..."},
      "renato": {"title":"Renato Dean","photo":"","text":"Renato served nearly a decade in the military..."},
      "demarco": {"title":"Demarco Victoria","photo":"","text":"Demarco and his three children are part of the wider Dean network."},
      "gino": {"title":"Gino Dean","photo":"","text":"Gino lives in San Diego..."},
      "giana": {"title":"Giana Dean","photo":"","text":"Giana’s death by suicide is a deep wound..."},
      "demetri": {"title":"Demetri Dean","photo":"","text":"Possibly a cousin — Demetri appears in family memory..."},
      "eugene": {"title":"Eugene Edward Kirili (1936–1994)","photo":"","text":"Eugene’s life traces a path across Ohio and Pennsylvania..."},
      "ruth_barris": {"title":"Ruth Adaline Barris (b. 1939)","photo":"","text":"Ruth’s life is traced through small community ties..."},
      "fisher_note": {"title":"Fisher / Crozier / Fischer notes","photo":"","text":"Some family lines use Fisher, some Fischer..."},
      "michael": {"title":"Michael Dean (You)","photo":"","text":"Michael Dean — born December 10, 2008..."}
    };

    function openStory(key){
      const s = stories[key];
      if(!s) return;
      const modal = document.getElementById('story-modal');
      const content = document.getElementById('story-content');
      content.innerHTML = '<h2 style="margin-top:0;">' + s.title + '</h2>' + (s.photo ? ('<img src="'+s.photo+'" class="story-photo" alt="'+s.title+'">') : '') + '<p>' + s.text + '</p>';
      modal.style.display = 'flex';
    }
    function closeStory(){ document.getElementById('story-modal').style.display = 'none'; }
    window.addEventListener('click', function(e){ const modal = document.getElementById('story-modal'); if(e.target === modal) closeStory(); });

    // ------------------------------
    // Page tabs logic
    // ------------------------------
    const tabTree = document.getElementById('tabTree');
    const tabMap = document.getElementById('tabMap');
    const treePage = document.getElementById('treePage');
    const mapPage = document.getElementById('mapPage');
    const btnReturn = document.getElementById('btnReturn');

    tabTree.addEventListener('click', ()=> setActiveTab('tree'));
    tabMap.addEventListener('click', ()=> setActiveTab('map'));
    btnReturn && btnReturn.addEventListener('click', ()=> setActiveTab('tree'));

    function setActiveTab(active){
      if(active === 'tree'){
        tabTree.classList.add('active'); tabMap.classList.remove('active');
        treePage.style.display='block'; mapPage.style.display='none';
        tabTree.setAttribute('aria-selected','true'); tabMap.setAttribute('aria-selected','false');
      } else {
        tabMap.classList.add('active'); tabTree.classList.remove('active');
        treePage.style.display='none'; mapPage.style.display='block';
        tabMap.setAttribute('aria-selected','true'); tabTree.setAttribute('aria-selected','false');
        // initialize the map the first time the tab is opened
        if(!window.birthmap) {
          initMap();
        } else {
          // if already initialized, make sure it resizes properly
          setTimeout(()=>{ window.birthmap.invalidateSize(); }, 220);
        }
      }
    }

    // ------------------------------
    // Map data (estimated coords) - full-format labels
    // ------------------------------
    const birthPlaces = [
      { key:'james_vaccaro', name:'James Vaccaro — Pennsylvania (Born 1913–1985)', lat:40.2732, lon:-76.8867 },
      { key:'rose_kirila', name:'Rose Louise Kirila — Ohio (Born 1929)', lat:39.9612, lon:-82.9988 },
      { key:'deborah', name:'Deborah (Vaccaro) Patton — Ohio (Born 1959)', lat:39.9612, lon:-82.9988 },
      { key:'william_patton', name:'William Patton — Belfast, Northern Ireland (Born unknown)', lat:54.5973, lon:-5.9301 },
      { key:'beatrice_fisher', name:'Beatrice Fisher — Dublin, Ireland (Born unknown)', lat:53.3498, lon:-6.2603 },
      { key:'lynne', name:'Lynne Patton — Dublin, Ireland (Born unknown)', lat:53.3498, lon:-6.2603 },
      { key:'gary', name:'Gary Patton — Belfast, Northern Ireland (Born 1956)', lat:54.5973, lon:-5.9301 },
      { key:'daniel', name:'Daniel Patton — Woodland Hills, CA (Born 1992)', lat:34.1683, lon:-118.6057 },
      { key:'shannen', name:'Shannen Patton — Woodland Hills, CA (Born 1987)', lat:34.1683, lon:-118.6057 },
      { key:'brian', name:'Brian Kupfer — Ojai, CA (Born 1981)', lat:34.4486, lon:-119.2429 },
      { key:'breanna', name:'Breanna Kupfer — Ventura, CA (Born 2021)', lat:34.2746, lon:-119.2290 },
      { key:'alexis', name:'Alexis Kupfer — Ventura, CA (Born 2016)', lat:34.2746, lon:-119.2290 },
      { key:'robert_kupfer', name:'Robert Kupfer — Pennsylvania (Born unknown)', lat:39.9526, lon:-75.1652 },
      { key:'patricia_kupfer', name:'Patricia Kupfer — Pennsylvania (Born unknown)', lat:39.9526, lon:-75.1652 },
      { key:'cort', name:'Cort Kupfer — Ojai, CA (Born unknown)', lat:34.4486, lon:-119.2429 },
      { key:'crystal', name:'Crystal Kupfer — Ojai, CA (Born unknown)', lat:34.4486, lon:-119.2429 },
      { key:'april', name:'April Kupfer — Ojai, CA (Born unknown)', lat:34.4486, lon:-119.2429 },
      { key:'everett', name:'Everett Kupfer — Ojai, CA (Born unknown)', lat:34.4486, lon:-119.2429 },
      { key:'jonathan', name:'Jonathan Kupfer — Ojai, CA (Born unknown)', lat:34.4486, lon:-119.2429 },
      { key:'nannete', name:'Nannete Dean — Thousand Oaks, CA (Born unknown)', lat:34.1703, lon:-118.8376 },
      { key:'mario', name:'Mario Dean — Thousand Oaks, CA (1985–2014)', lat:34.1703, lon:-118.8376 },
      { key:'carlo', name:'Carlo Dean — Thousand Oaks, CA (Born unknown)', lat:34.1703, lon:-118.8376 },
      { key:'renato', name:'Renato Dean — Missouri (Born unknown)', lat:38.5767, lon:-92.1735 },
      { key:'demarco', name:'Demarco Victoria — Missouri (Born unknown)', lat:38.5767, lon:-92.1735 },
      { key:'gino', name:'Gino Dean — Missouri (Born unknown)', lat:38.5767, lon:-92.1735 },
      { key:'giana', name:'Giana Dean — Missouri (Born unknown)', lat:38.5767, lon:-92.1735 },
      { key:'demetri', name:'Demetri Dean — Missouri (Born unknown)', lat:38.5767, lon:-92.1735 },
      { key:'eugene', name:'Eugene Edward Kirili — Missouri (1936–1994)', lat:38.5767, lon:-92.1735 },
      { key:'ruth_barris', name:'Ruth Adaline Barris — Missouri (Born 1939)', lat:38.5767, lon:-92.1735 },
      { key:'michael', name:'Michael Dean — Thousand Oaks, CA (Born 2008)', lat:34.1703, lon:-118.8376 }
    ];

    // ------------------------------
    // Initialize Leaflet map when user opens map tab
    // ------------------------------
    function initMap(){
      if(window.birthmap) return; // already initialized

      // create map
      const map = L.map('birth-map', { scrollWheelZoom: true }).setView([39.5, -95.35], 4);
      window.birthmap = map;

      // tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // markers group
      const markers = L.layerGroup().addTo(map);

      birthPlaces.forEach(p => {
        if(!p.lat || !p.lon) return;
        const marker = L.marker([p.lat, p.lon]).addTo(markers);
        const popup = `
          <div style="min-width:170px">
            <strong>${escapeHtml(p.name)}</strong><br/>
            <a href="#" data-key="${p.key}" class="open-story-link" style="display:inline-block;margin-top:6px;color:#1f6feb;text-decoration:none;font-weight:700">Open story</a>
          </div>`;
        marker.bindPopup(popup);
      });

      // open story link delegation
      document.getElementById('birth-map').addEventListener('click', function(e){
        const a = e.target.closest && e.target.closest('.open-story-link');
        if(a){
          e.preventDefault();
          const k = a.getAttribute('data-key');
          if(k){ openStory(k); }
        }
      });

      // once map initialized, ensure correct sizing
      setTimeout(()=>{ try{ map.invalidateSize(); }catch(e){} }, 250);
    }

    // small helper to escape HTML in labels
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
    }

    // keep map from trying to init until user opens the Map tab:
    // If user reloads while Map tab already active, init on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function(){
      // if user navigated with hash #map, open map immediately
      if(location.hash === '#map') {
        setActiveTab('map');
      }
      // otherwise keep tree visible; map will init when tab clicked
    });

  </script>
</body>
</html>
